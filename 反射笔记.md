# JAVA反射机制

### 什么是反射
反射是指一类应用，它们能够自描述和自控制，也就是说，这类应用通过采用某种机制来实现对自己行为的描述和监测，并能根据自身行为的状态和结果，调整或修改应用所描述行为的状态和相关的语义。

JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于
任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能称为java语言的反射机制。 

Reflection 是 Java 被视为动态（或准动态）语言的关键，允许程序于执行期 Reflection APIs 取得任何已知名称之 class 的內部信息，包括 package、type parameters、superclass、implemented interfaces、inner classes, outer class, fields、constructors、methods、modifiers，並可于执行期生成instances、变更 fields 內容或唤起 methods。


### 反射作用
- 获取某些类的变量，调用某些类的私有方法。
- 增加代码的灵活性。很多主流框架都使用了反射技术。


### JAVA反射所必须的类
java的类反射需要:Field、Constructor、Method、Class、Object。

- Field类：提供有关类或接口的属性的信息，以及对它的动态访问权限。反射的字段可能是一 个类（静态）属性或实例属性，简单的理解可以把它看成一个封装反射类的属性的类
- Constructor类：提供关于类的单个构造方法的信息以及对它的访问权限。这个类和Field类 不同，Field类封装了反射类的属性，而Constructor类则封装了反射类的构造方法。
- Method类：提供关于类或接口上单独某个方法的信息。所反映的方法可能是类方法或实例方法（包括抽象方法）。 这个类不难理解，它是用来封装反射类方法的一个类。
- Class类：类的实例表示正在运行的 Java 应用程序中的类和接口。枚举是一种类，注释是一种接口。每个数组属于被映射为 Class 对象的一个类，所有具有相同元素类型和维数的数组都共享该 Class 对象。

----
**测试类A**
```java
import java.awt.event.ActionListener;
import java.awt.event.AcitonEvent;
class A extends Object implements ActionListener{
    private int a=3;
    public Integer b= new Integer(4);
    public A(){}
    public A(int id,String name){}
    public int abc(int id,String name){return 0;}
    public void actionPerformed(ActionEvent e){}
}
```


**将A作为反射类的测试代码，获取属性**
1. Field[] getFields()
2. Filed[] getDeclaredFields()
3. 获得指定成员变量：Field getDeclaredField(fieldName)
4. 如果成员变量是private，则declaredField.setAccessible(true)才能使用
```java
import java.lang.reflect.Field;

public class B {
    public static void main(String...args){
        A r = new A();
        Class temp = r.getClass();
        try{
            System.out.println("反射类中所有公有属性");
            Field[] fb = temp.getFields();
            for(int j=0;j<fb.length;j++) {
                Class cl = fb[j].getType();
                System.out.println("fb:" + cl);
            }

            System.out.println("反射类中所有属性");
            Field[] fa = temp.getDeclaredFields();
            for(int j=0;j<fa.length;j++) {
                Class cl = fa[j].getType();
                System.out.println("fa:" + cl);
            }

            System.out.println("反射类中私有属性的值" );
            Field f = temp.getDeclaredField("a" );
            f.setAccessible(true );
            Integer i = (Integer)f.get(r);
            System.out.println(i);
        }catch(Exception e){}
    }
}

```

**获取类的构造方法**
```java
import java.lang.reflect.Constructor;

public class C {
    public static void main(String...args){
        A r = new A();
        printConstructor(r);
    }

    public static void printConstructor(A r){
        Class clazz = r.getClass();
        //获取指定类的类名
        String className = clazz.getName();
        try{
            //获取指定类的构造方法
            Constructor[] Constructors = clazz.getConstructors();
            for(int i=0;i<Constructors.length;i++){
                //获取指定构造方法的参数的集合
                Class[] paramterTypes = Constructors[i].getParameterTypes();
                System.out.print(className+"(");
                for( Class parameter:paramterTypes)
                    System.out.print(parameter.getName()+" ");
                /*for(int j=0;j<paramterTypes.length;j++)
                    System.out.print(paramterTypes[j].getName()+" ");*/
                System.out.println(")");
            }
        }catch (Exception e){e.printStackTrace();}
    }
}
```

**获取反射类的父类和接口**
```java
public class D {
    public static void main(String...args){
        A raw = new A();
        printInterfaceName(raw);
    }

    public static void printInterfaceName(Object obj){
        Class clazz = obj.getClass();
        //获取反射类的接口
        Class[] interfaces = clazz.getInterfaces();
        for(Class theInterface : interfaces)
            System.out.println(theInterface.getName());
        //获取反射类的父类
        Class theSuperClass = clazz.getSuperclass();
        System.out.println(theSuperClass.getName());
    }
}
```

**获取反射类的方法**
包括父类的所有方法
1. Method[] getDecalredMethods()
2. Method[] getMethods() throws SecurityException
3. Method getDeclaredMethod()
4. Method getMethod(String name, Class<?>... parameterTypes)
```java
import java.lang.reflect.Method;

public class E {
    public static void main(String...args){
        A raw = new A();
        printMethods(raw);
    }

    public static void printMethods(Object obj){
        Class clazz = obj.getClass();
        String className = clazz.getName();
        Method[] methods = clazz.getMethods();
        for(Method m :methods){
            //输出方法返回类型
            System.out.print(m.getReturnType().getName()+" ");
            //输出方法名
            System.out.print(m.getName()+"(");
            //输出方法的参数
            for(Class parameter: m.getParameterTypes())
                System.out.print(parameter.getName()+"");
            System.out.println(")");
        }
    }
}

```

**使用反射操作数组**
```java
import java.lang.reflect.Array;

public class Test{
    public static void main(String...args){
        String[] strArray = new String[]{"苹果"," 西瓜","桃子","凤梨"};
        Array.set(strArray,0,"菠萝");
        Class clazz = strArray.getClass();
        if(clazz.isArray()){
            for(Object obj:strArray)
            System.out.println("0bject="+obj+","+"ClassName="+obj.getClass().getName());
        }
    }
}
```

